#!/usr/bin/env bash
set -euo pipefail

if ! command -v black >/dev/null 2>&1; then
  echo "pre-push: black is not installed. Install it with: pip install black"
  exit 1
fi

py_files="$(git ls-files '*.py')"
if [ -z "${py_files}" ]; then
  exit 0
fi

# shellcheck disable=SC2086
black ${py_files}

if ! git diff --quiet -- '*.py'; then
  echo "pre-push: black reformatted Python files."
  echo "pre-push: commit the formatting changes, then push again."
  exit 1
fi
